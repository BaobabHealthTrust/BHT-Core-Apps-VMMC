<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />

    <script language="javascript" defer="true">
      tstUsername = "";
      tstUserKeyboardPref = "qwerty";

      tstCurrentDate = "";


    </script>

    <script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer="true"></script>
    <script type="text/javascript" src="/assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="/apps/VMMC/assets/js/common.js"></script>
    <link rel="stylesheet" media="screen" href="/apps/VMMC/assets/css/yes_no_btn.css" />

  </head>
  <body id="mateme">
    <div id="container">
      <div id="content">

<!-- <script language="javascript" type="text/javascript" src="/javascripts/jquery.flot.js"></script>

<script src="/javascripts/Highcharts/js/jquery.min.js"></script>
<script src="/javascripts/Highcharts/js/highcharts.js"></script>
<script src="/javascripts/vitals_trail.js"></script>
<script src="/javascripts/notification_tracker.js"></script> -->
 

<style type="text/css">

  #Unknown{
    display: none;
  }

  #divcontent {
    background-color: #fff;
    border: 2px solid #ccf;
    border-radius: 10px;
    height: 84%;
    margin: 10px;
    overflow: hidden;
    width: 98%;
  }

  .ShortSelectList, 
  .NumbersOnlyWithDecimal,
  .NumbersOnly,
  .DatesOnly { height: 655px !important }

  #divScroller {
    height: 97%;
    margin: 10px;
    overflow: auto;
    width: 98%;
  }

  .disabled-li{
    text-decoration: line-through;
    color: gray !important;
  }
</style>





<script type="text/javascript">
var sideEffectsHash = [];
      sideEffectsHash['Pain'] = {none: '', mild: '', mod: '', sev: ''}
      sideEffectsHash['Bleeding'] = {none: '', mild: '', mod: '', sev: ''}
      sideEffectsHash['Haematoma'] = {none: '', mild: '', mod: '', sev: ''}
      sideEffectsHash['Swelling'] = {none: '', mild: '', mod: '', sev: ''}
      sideEffectsHash['Glans damage'] = {none: '', mild: '', mod: '', sev: ''}
      sideEffectsHash['Infection'] = {none: '', mild: '', mod: '', sev: ''}
      sideEffectsHash['Wound disruption'] = {none: '', mild: '', mod: '', sev: ''}
      sideEffectsHash['Urinary problems'] = {none: '', mild: '', mod: '', sev: ''}

  function advancedSideEffects(){

    var sideEffectsArray = ['Pain','Bleeding','Haematoma','Swelling','Glans damage','Infection','Wound disruption','Urinary problems'];
  
    jQuery("#inputFrame" + tstCurrentPage).remove();
    jQuery("#helpText" + tstCurrentPage).css({
      marginLeft: "0%",
      fontWeight: "bold",
      fontSize: "1.9em"
    })

    html = "<div id='divcontent'>";
    html += "<div id='divScroller'>";
    // var sideEffectsOptions = "JSON.parse('[&quot;Pain&quot;,&quot;Bleeding&quot;,&quot;Haematoma&quot;,&quot;Swelling&quot;,&quot;Glans damage&quot;,&quot;Infection&quot;,&quot;Wound disruption&quot;,&quot;Urinary problems&quot;]');";
    html += "<table cellspacing='1' cellpadding='2' width='95%' id='yes_no_table'>";
    html += "<tbody>";


    for (var i=0; i<=sideEffectsArray.length - 1; i++){

      html += "<tr>";
      html += "<td class='labelText'>" + sideEffectsArray[i] + "</td>";

      
      html += "<td style='width: 30%;'>";
      html += "<table style='float: right; width: 100%; padding-right: 10px;' class='btn-table'>";
      html += "<tr>";
      
      html += "<td>";
      html += "<div class='switch switch-none' id='none_btn_container_" + i + "' category='side_effects' ";
      html += "key='" + sideEffectsArray[i] + "' onmousedown='clicked(this);'>";
      html += "<input class='hidden-checkbox' id='none_checkbox_" + i + "' type='checkbox'>";
      html +="<label id='none_lable_" + i + "'><i></i></label>";
      html += "</td>";
     
      html += "<td>";
      html += "<div class='switch switch-mild' id='mild_btn_container_" + i + "' category='side_effects' ";
      html += "key='" + sideEffectsArray[i] + "' onmousedown='clicked(this);'>";
      html += "<input class='hidden-checkbox' id='mild_checkbox_" + i + "' type='checkbox'>";
      html +="<label id='mild_lable_" + i + "'><i></i></label>";
      html += "</td>";

      html += "<td>";
      html += "<div class='switch switch-mod' id='mod_btn_container_" + i + "' category='side_effects' ";
      html += "key='" + sideEffectsArray[i] + "' onmousedown='clicked(this);'>";
      html += "<input class='hidden-checkbox' id='mod_checkbox_" + i + "' type='checkbox'>";
      html +="<label id='mod_lable_" + i + "'><i></i></label>";
      html += "</td>";

      html += "<td>";
      html += "<div class='switch switch-sev' id='sev_btn_container_" + i + "' category='side_effects' ";
      html += "key='" + sideEffectsArray[i] + "' onmousedown='clicked(this);'>";
      html += "<input class='hidden-checkbox' id='sev_checkbox_" + i + "' type='checkbox'>";
      html +="<label id='sev_lable_" + i + "'><i></i></label>";
      html += "</td>";
     
      html += "</tr>";
      html += "</table>";
      html += "</td>";
     
     
      html += "</tr>"
    }

    html += "<tbody>"
    html += "</table>";
    html += "</div>";
    html += "</div>";

    thisPage = document.getElementById('page' + tstCurrentPage);
    thisPage.innerHTML += html;

    preselectSelectedSideEffects();
    setBackButton();
    __$('nextButton').onmousedown = function(){
      validateSideEffectsInput();
    }
    
  }

  function validateSideEffectsInput(){
    unselectedSideEffects = [];
    for (var key in sideEffectsHash){
      sevValue = sideEffectsHash[key]["sev"];
      noneValue = sideEffectsHash[key]["none"];
      mildValue = sideEffectsHash[key]["mild"];
      modValue = sideEffectsHash[key]["mod"];
      console.log()
      if (sevValue.length == 0 && noneValue.length == 0 && mildValue.length == 0 && modValue.length == 0){
        //The row was not selected
        unselectedSideEffects.push(key);
      }
    }

    if (unselectedSideEffects.length > 0){
      showMessage("The following are not selected <br />" +  unselectedSideEffects.join('<br /> '));
    }else{
      gotoNextPage();
    }
  }

  function setBackButton(){
    backButton = jQuery('#backButton')[0];
    if (backButton){
      mouseEvent = backButton.getAttribute('onmousedown');
      if (mouseEvent){
        if (!mouseEvent.match(/resetNextButton/i)){
          onmousedownevent = backButton.getAttribute('onmousedown') + '; resetNextButton()';
          backButton.setAttribute('onmousedown', onmousedownevent);
        }
      }
    }
  }


  function preselectSelectedSideEffects(){


    for (var key in sideEffectsHash){
     
      noneValue = sideEffectsHash[key]["none"];
      mildValue = sideEffectsHash[key]["mild"];
      modValue = sideEffectsHash[key]["mod"];
      sevValue = sideEffectsHash[key]["sev"];

      buttons = jQuery("[key='" + key + "']");
      none_button = buttons[0];
      mild_button = buttons[1];
      mod_button = buttons[2];
      sev_button = buttons[3];


      divs = document.getElementsByClassName('switch');
      for(var i = 0; i < divs.length; i++){
        divKey = divs[i].getAttribute('key');

        if(key == divKey){
          if(noneValue.length > 0) {
            index = none_button.id.replace("none_btn_container_",'');
            hidden_checkbox_none = document.getElementById('none_checkbox_' + index);
            on_label_checkbox = document.getElementById('none_lable_' + index);
            on_label_checkbox.setAttribute('style','color: white; background-color: lightgreen;');
            hidden_checkbox_none.checked = true;
            break;
          }else if(mildValue.length > 0){
            index = mild_button.id.replace("mild_btn_container_",'');
            hidden_checkbox_mild = document.getElementById('mild_checkbox_' + index);
            on_label_checkbox = document.getElementById('mild_lable_' + index);
            on_label_checkbox.setAttribute('style','color: white; background-color: lightgreen;');
            hidden_checkbox_mild.checked = true;
            break;
          }else if(modValue.length > 0){
            index = mod_button.id.replace("mod_btn_container_",'');
            hidden_checkbox_mod = document.getElementById('mod_checkbox_' + index);
            on_label_checkbox = document.getElementById('mod_lable_' + index);
            on_label_checkbox.setAttribute('style','color: white; background-color: lightgreen;');
            hidden_checkbox_mod.checked = true;
            break;
          }else if(sevValue.length > 0){
            index = sev_button.id.replace("sev_btn_container_",'');
            hidden_checkbox_sev = document.getElementById('sev_checkbox_' + index);
            on_label_checkbox = document.getElementById('sev_lable_' + index);
            on_label_checkbox.setAttribute('style','color: white; background-color: lightgreen;');
            hidden_checkbox_sev.checked = true;
            break;
          }
        }
      }
 
    }
  }

  function clicked(e) {
    category = e.getAttribute('category');
    key = e.getAttribute('key');
    
    if(e.id.match(/none_btn_container_/i)) {
      updateSideEffectNoneValue(e);
      index = e.id.replace("none_btn_container_",'');
      hidden_checkbox_mild = document.getElementById('mild_checkbox_' + index);
      hidden_checkbox_mod = document.getElementById('mod_checkbox_' + index);
      hidden_checkbox_sev = document.getElementById('sev_checkbox_' + index);
      hidden_checkbox_none = document.getElementById('none_checkbox_' + index);
 
      off_hidden_checkbox = document.getElementById('none_checkbox_' + index);
      on_label_checkbox = document.getElementById('none_lable_' + index);

      off_label_checkbox_mild = document.getElementById('mild_lable_' + index);
      off_label_checkbox_mod = document.getElementById('mod_lable_' + index);
      off_label_checkbox_sev = document.getElementById('sev_lable_' + index);

        off_hidden_checkbox.checked = false;
        off_label_checkbox_mild.setAttribute('style','color: black; background-color: ""');
        off_label_checkbox_mod.setAttribute('style','color: black; background-color: ""');
        off_label_checkbox_sev.setAttribute('style','color: black; background-color: ""');
        on_label_checkbox.setAttribute('style','color: white; background-color: lightgreen;');

        if(hidden_checkbox_mild.checked) 
        {
          hidden_checkbox_mild.checked = false;
        }else if (hidden_checkbox_mod.checked){
          hidden_checkbox_mod.checked = false;
        }else if (hidden_checkbox_sev.checked)
        {
           hidden_checkbox_sev.checked = false;
        }
        else
        {
           hidden_checkbox_none.checked = true;
        }


    }
    else if (e.id.match(/mild_btn_container_/i)) {
      updateSideEffectMildValue(e);
      index = e.id.replace("mild_btn_container_",'');
      hidden_checkbox_none = document.getElementById('none_checkbox_' + index);
      hidden_checkbox_mod = document.getElementById('mod_checkbox_' + index);
      hidden_checkbox_sev = document.getElementById('sev_checkbox_' + index);
      hidden_checkbox_mild = document.getElementById('sev_checkbox_' + index);

      off_hidden_checkbox = document.getElementById('mild_checkbox_' + index);
      on_label_checkbox = document.getElementById('mild_lable_' + index);

      off_label_checkbox_none = document.getElementById('none_lable_' + index);
      off_label_checkbox_mod = document.getElementById('mod_lable_' + index);
      off_label_checkbox_sev = document.getElementById('sev_lable_' + index);

        off_hidden_checkbox.checked = false;
        off_label_checkbox_none.setAttribute('style','color: black; background-color: ""');
        off_label_checkbox_mod.setAttribute('style','color: black; background-color: ""');
        off_label_checkbox_sev.setAttribute('style','color: black; background-color: ""');
        on_label_checkbox.setAttribute('style','color: white; background-color: lightgreen;');
        

        if(hidden_checkbox_none.checked) 
        { 
          hidden_checkbox_none.checked = false;
        }else if (hidden_checkbox_mod.checked){
          hidden_checkbox_mod.checked = false;
        }else if (hidden_checkbox_sev.checked)
        {
           hidden_checkbox_sev.checked = false;
        }
        else
        {
           hidden_checkbox_mild.checked = true;
        }



    }
    else if (e.id.match(/mod_btn_container_/i)){
      updateSideEffectModValue(e);
      index = e.id.replace("mod_btn_container_",'');
      hidden_checkbox_none = document.getElementById('none_checkbox_' + index);
      hidden_checkbox_mod = document.getElementById('mod_checkbox_' + index);
      hidden_checkbox_sev = document.getElementById('sev_checkbox_' + index);
      hidden_checkbox_mild = document.getElementById('sev_checkbox_' + index);

      off_hidden_checkbox = document.getElementById('mod' + index);
      on_label_checkbox = document.getElementById('mod_lable_' + index);

      off_label_checkbox_none = document.getElementById('none_lable_' + index);
      off_label_checkbox_mild = document.getElementById('mild_lable_' + index);
      off_label_checkbox_sev = document.getElementById('sev_lable_' + index);

      
      off_label_checkbox_none.setAttribute('style','color: black; background-color: ""');
      off_label_checkbox_mild.setAttribute('style','color: black; background-color: ""');
      off_label_checkbox_sev.setAttribute('style','color: black; background-color: ""');

      on_label_checkbox.setAttribute('style','color: white; background-color: lightgreen;');
        

        if(hidden_checkbox_none.checked) 
        { 
          hidden_checkbox_none.checked = false;
        }else if (hidden_checkbox_mild.checked){
          hidden_checkbox_mild.checked = false;
        }else if (hidden_checkbox_sev.checked)
        {
           hidden_checkbox_sev.checked = false;
        }
        else
        {
           hidden_checkbox_mod.checked = true;
        }


    }else if (e.id.match(/sev_btn_container_/i)){
      updateSideEffectSevValue(e);
      index = e.id.replace("sev_btn_container_",'');
      
      hidden_checkbox_none = document.getElementById('none_checkbox_' + index);
      hidden_checkbox_mod = document.getElementById('mod_checkbox_' + index);
      hidden_checkbox_sev = document.getElementById('sev_checkbox_' + index);
      hidden_checkbox_mild = document.getElementById('sev_checkbox_' + index);

      off_hidden_checkbox = document.getElementById('sev_checkbox_' + index);
      on_label_checkbox = document.getElementById('sev_lable_' + index);

      off_label_checkbox_none = document.getElementById('none_lable_' + index);
      off_label_checkbox_mild = document.getElementById('mild_lable_' + index);
      off_label_checkbox_mod = document.getElementById('mod_lable_' + index);
      
      off_label_checkbox_none.setAttribute('style','color: black; background-color: ""');
      off_label_checkbox_mild.setAttribute('style','color: black; background-color: ""');
      off_label_checkbox_mod.setAttribute('style','color: black; background-color: ""');

      on_label_checkbox.setAttribute('style','color: white; background-color: lightgreen;');
        

        if(hidden_checkbox_none.checked) 
        { 
          hidden_checkbox_none.checked = false;
        }else if (hidden_checkbox_mild.checked){
          hidden_checkbox_mild.checked = false;
        }else if (hidden_checkbox_sev.checked)
        {
           hidden_checkbox_mod.checked = false;
        }
        else
        {
           hidden_checkbox_sev.checked = true;
        }


    }

    inputID = key + '_child_concept';
    console.log(inputID)
        if(e.id.match(/none_/i)) {
          //__$(key).value = '';
          console.log(inputID)
          __$(inputID).value = 'None';
          updateSideEffectNoneValue(e);
        }else if(e.id.match(/sev_/i)) {
          //__$(key).value = '';
          console.log(inputID);
          __$(inputID).value = 'Severe';

          updateSideEffectSevValue(e);
        }else if(e.id.match(/mod_/i)) {
          //__$(key).value = '';
          __$(inputID).value = 'Moderate';
          updateSideEffectModValue(e);
        }else if(e.id.match(/mild_/i)) {
          //__$(key).value = '';
          __$(inputID).value = 'Mild';
          updateSideEffectMildValue(e);
        }

  }

  function updateSideEffectNoneValue(obj){
      key = obj.getAttribute('key');
      sideEffectsHash[key]["none"] = 'true';
      sideEffectsHash[key]["mild"] = '';
      sideEffectsHash[key]["mod"] = '';
      sideEffectsHash[key]["sev"] = '';
    }

    function updateSideEffectMildValue(obj){
      key = obj.getAttribute('key');
      sideEffectsHash[key]["none"] = '';
      sideEffectsHash[key]["mild"] = 'True';
      sideEffectsHash[key]["mod"] = '';
      sideEffectsHash[key]["sev"] = '';
    }

   function updateSideEffectModValue(obj){
      key = obj.getAttribute('key');
      sideEffectsHash[key]["none"] = '';
      sideEffectsHash[key]["mild"] = '';
      sideEffectsHash[key]["mod"] = 'True';
      sideEffectsHash[key]["sev"] = '';
    }

    function updateSideEffectSevValue(obj){
      key = obj.getAttribute('key');
      sideEffectsHash[key]["none"] = '';
      sideEffectsHash[key]["mild"] = '';
      sideEffectsHash[key]["mod"] = '';
      sideEffectsHash[key]["sev"] = 'True';
    }



</script>

<form action="" method="POST">

  <input type="text" 
  name="observations[][value_text]" 
  id="follow-up-date" 
  field_type="date" 
  allowFreeText="true" 
  tt_onLoad="showCategory2('Follow-up review');"
  helptext="Follow up date" 
  absoluteMin="2019-05-10" />

  <input type="text" 
  name="advance_follow_up" 
  id="counselling" 
  field_type="number" 
  tt_pageStyleClass="Numeric NumbersOnly" 
  tt_onLoad="__$('keyboard').style.display = 'none'; advancedSideEffects();showCategory2('Follow-up review');" 
  helpText="Client follow up information" />
    
  <select name="observations[][value_coded_or_text]" 
  id="excessive-skin" 
  tt_pageStyleClass="NoKeyboard" 
  allowFreeText="false" 
  tt_onLoad="showCategory2('Follow-up review');"
  helpText="Excessive skin removed?"><option value=''></option>
  <option value=""></option>
  <option value="Yes">Yes</option>
  <option value="No">No</option></select>

  <select name="observations[][value_coded_or_text]" 
  id="insufficient-skin" 
  tt_pageStyleClass="NoKeyboard" 
  allowFreeText="false" 
  tt_onLoad="showCategory2('Follow-up review');"
  helpText="Insufficient skin removed?"  
  condition="__$('excessive-skin').value.match(/NO/i)"><option value=''></option>
  <option value=""></option>
  <option value="Yes">Yes</option>
  <option value="No">No</option></select>

  <select name="observations[][value_coded_or_text]" 
  id="delayed-wound-healing" 
  tt_pageStyleClass="NoKeyboard" 
  allowFreeText="false" 
  tt_onLoad="showCategory2('Follow-up review');" 
  helpText="Delayed wound healing?"><option value=''></option>
  <option value=""></option>
  <option value="Yes">Yes</option>
  <option value="No">No</option></select>

  <input type="text" 
  name="observations[][value_text]" 
  id="other_ae" 
  field_type="alpha" 
  allowFreeText="true" 
  tt_onLoad="showCategory2('Follow-up review');"
  helpText="Other AE (Specify)" 
  optional="true" />

  <input type="text" 
  name="observations[][value_text]" 
  id="findings_summary" 
  field_type="alpha" 
  allowFreeText="true" 
  tt_onLoad="showCategory2('Follow-up review');"
  helpText="Summary of findings" />

  <input type="text" 
  name="observations[][value_text]" 
  id="management_findings" 
  field_type="alpha" 
  allowFreeText="true" 
  tt_onLoad="showCategory2('Follow-up review');"
  helpText="Management of findings" 
  optional="true" />

  <select name="observations[][value_coded_or_text]" 
  id="counselling" 
  tt_pageStyleClass="NoKeyboard" 
  allowFreeText="false" 
  tt_onLoad="showCategory2('Follow-up review');"
  helpText="Was counselling done?"><option value=''></option>
  <option value=""></option>
  <option value="Yes">Yes</option>
  <option value="No">No</option></select>

  <input type="text" 
  name="observations[][value_text]" 
  id="counselling" 
  field_type="number" 
  allowFreeText="true" 
  min="0" 
  max="500" 
  tt_pageStyleClass="Numeric NumbersOnly" 
  helpText="Number of condoms given" />
</form>


        <div id="footer">
        </div>
      </div>
    </div>
  </body>
</html>

<script type="text/javascript">

  var patientID = sessionStorage.patientID;
  var patientID = sessionStorage.getItem("patientID");
  var programID = sessionStorage.getItem("programID");
  var tt_cancel_destination = "/views/patient_dashboard.html?patient_id=" + patientID;

</script>
